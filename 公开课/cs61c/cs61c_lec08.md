
`lec08.pdf` 文件详细介绍了 RISC-V 指令集架构中的指令格式和其他相关概念。以下是该课程内容的详细讲解：

### 0.1 抽象的概念
- 介绍了不同级别的抽象，包括高级语言、汇编语言、机器语言和硬件架构描述。
- 解释了编译器、汇编器和机器解释的作用。
- ![QQ_1723432805868.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121120527.png)


### 0.2 指令格式
- 指出每条指令都是 32 位宽，并分为不同的字段。
- 介绍了 RISC-V 指令集的几种格式：R 格式、I 格式、S 格式和 U 格式。

### 0.3 R 格式
- R 格式是一种寄存器-寄存器类型的指令，涉及三个寄存器：两个源寄存器和一个目标寄存器。
- 介绍了 R 格式的字段布局，包括 `funct7`、`rs2`、`rs1`、`funct3`、`rd` 和 `opcode`。
- ![QQ_1723432888178.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121121924.png)


### 0.4 R 格式指令的操作
- 通过 `funct7` 和 `funct3` 字段与 `opcode` 结合来确定要执行的操作。

### 0.5 R 格式指令的寄存器
- 解释了寄存器字段 `rs1`、`rs2` 和 `rd` 的作用，以及它们如何存储 5 位无符号整数来表示寄存器号。

### 0.6 R 格式示例
- 通过示例 `add x18, x19, x10` 展示了 R 格式指令的二进制表示。
- ![QQ_1723433031070.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121124796.png)


---
在RISC-V指令集中，`opcode`、`funct3`和`funct7`字段是构成一条指令的基本组成部分，它们共同定义了指令的类型和行为。下面是对这些字段的理解：

1. **Opcode**：操作码是一个固定的位模式，用于标识指令的类别。例如，所有R型（寄存器-寄存器）类型的指令都有一个特定的操作码来区分它们与I型（寄存器-立即数）或S型（存储）指令等。

2. **Funct3**：功能码的低三位（funct3）提供了额外的信息，用于在具有多种变体的指令中选择特定的操作。例如，在RISC-V中，`add`和`sub`操作都使用相同的操作码，但是通过`funct3`字段来区分是执行加法还是减法。

3. **Funct7**：功能码的高七位（funct7）为某些指令提供了更多的编码空间，允许同一操作码下有更多的操作变体。例如，在浮点指令中，`funct7`字段可以用于选择不同的浮点运算。

在RISC-V的32位指令编码中，这些字段通常按如下方式组织：

- 前7位是`opcode`。
- 接下来的3位是`funct3`。
- 然后是5位操作数编码，对于R型指令是`rs1`和`rs2`，对于I型指令是`rs1`和`立即数`。
- 对于R型指令，后面是3位`rd`编码。
- 对于I型和S型指令，接下来的12位是立即数编码。

例如，在R型指令中，格式如下：

```
|---7---|---3---|---5---|---3---|---5---|
| opcode| 000  |  rs2  | funct3|  rd   |
```

在I型指令中，格式如下：

```
|---7---|---3---|---5---|---13--|
| opcode| 000  |  rs1  |  immed |
```

在理解RISC-V指令时，重要的是要参考官方的指令集文档，因为不同的指令和指令类别可能有不同的`funct3`和`funct7`编码。这些编码定义了指令的具体行为，例如算术运算、逻辑运算、位移运算等。

---



### 0.7 I 格式
- I 格式是寄存器-立即数类型的指令，涉及一个寄存器和一个立即数。
- ![QQ_1723433921428.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121138629.png)


### 0.8 I 格式布局
- 介绍了 I 格式的字段布局，包括 `imm[11:0]`、`rs1`、`funct3`、`rd` 和 `opcode`。
- ![QQ_1723433971779.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121139304.png)


### 0.9 I 格式指令
- 讨论了立即数的表示范围和如何进行符号扩展。

### 0.10 I 格式示例
- 通过示例 `addi x15, x18, -50` 展示了 I 格式指令的二进制表示。
- ![QQ_1723433982351.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121140046.png)


### 0.11 加载指令
- 介绍了加载指令的不同类型，包括加载字（`lw`）、加载字节（`lb`）、加载无符号字节（`lbu`）和加载半字（`lh`、`lhu`）。
- ![QQ_1723434083872.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121141187.png)
- ![QQ_1723434099400.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121141286.png)



### 0.12 加载指令的内存表示
- 解释了加载指令如何从内存中加载不同大小的数据到寄存器。
- ![QQ_1723434136872.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121142239.png)
- ![QQ_1723434152043.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121142486.png)



### 0.13 S 格式
- S 格式是存储指令的格式，涉及两个源寄存器。

### 0.14 存储指令
- 介绍了存储指令的不同类型，包括存储字（`sw`）、存储字节（`sb`）和存储半字（`sh`）。
- ![QQ_1723460138224.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121855346.png)


### 0.15 存储指令的内存表示
- 解释了存储指令如何将数据从寄存器存储到内存。

### 0.16 分支指令
- 讨论了条件分支指令的用法，包括 `beq`（如果相等则分支）、`bne`（如果不相等则分支）等。

### 0.17 分支指令的地址范围
- 介绍了分支指令可以跳转的范围，基于 PC 相对地址。
- ![QQ_1723460252195.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121857122.png)


### 0.18 分支指令的编码
- 详细解释了分支指令的立即数字段如何编码，以及如何计算跳转偏移。
- ![QQ_1723460370417.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121859256.png)
- ![QQ_1723460423636.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121900678.png)



### 0.19 RISC-V 的 16 位指令扩展
- 介绍了 RISC-V 支持的 16 位压缩指令，以及它们如何增加指令的密度。
- ![QQ_1723460357215.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121859661.png)


### 0.20 J 格式
- J 格式是跳转指令的格式，允许跳转到更远的地址。

### 0.21 JALR 指令
- 介绍了 `jalr` 指令，它用于相对地址的跳转，并可以作为返回指令使用。

### 0.22 PC 相对地址与绝对地址
- 对比了 PC 相对地址跳转和绝对地址跳转的概念。

### 0.23 U 格式
- U 格式是用于加载立即数到寄存器的指令格式，如 `lui`（加载上立即数）。
- ![QQ_1723460812660.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121907783.png)


### 0.24 LUI 和 AUIPC 指令
- 介绍了 `lui` 指令如何加载立即数的上 20 位到寄存器，以及 `auipc`（加立即数到 PC）如何用于计算 PC 相对的地址。

### 0.25 总结
- 对 RISC-V 指令格式进行了总结，强调了它们在不同场景下的应用。
- ![QQ_1723460990428.png](https://cdn.jsdelivr.net/gh/WncFht/picture/202408121909848.png)


这份讲义深入探讨了 RISC-V 指令集的不同格式，包括它们的字段布局、操作和应用场景。通过这些内容，学生可以更深入地理解 RISC-V 指令集的工作原理和如何有效地使用各种指令。